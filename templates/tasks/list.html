{% extends 'base.html' %}

{% block title %}任务列表 - 工作日历系统{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>任务列表</h2>
    <a href="{{ url_for('task.create_task') }}" class="btn btn-success">创建新任务</a>
</div>

<div class="card">
    <div class="card-body">
        {% if tasks %}
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>标题</th>
                            <th>状态</th>
                            <th>优先级</th>
                            <th>截止日期</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for task in tasks %}
                            <tr>
                                <td>{{ task.title }}</td>
                                <td>
                                    <span class="badge bg-{{ 'success' if task.status == 'completed' else 'warning' if task.status == 'in_progress' else 'secondary' }}">
                                        {{ {'pending': '待处理', 'in_progress': '进行中', 'completed': '已完成'}[task.status] }}
                                    </span>
                                </td>
                                <td>
                                    <span class="badge bg-{{ 'danger' if task.priority == 'high' else 'info' if task.priority == 'medium' else 'light text-dark' }}">
                                        {{ {'high': '高', 'medium': '中', 'low': '低'}[task.priority] }}
                                    </span>
                                </td>
                                <td>{{ task.due_date.strftime('%Y-%m-%d') if task.due_date else '无' }}</td>
                                <td>
                                    <a href="{{ url_for('task.view_task', task_id=task.id) }}" class="btn btn-sm btn-primary">查看</a>
                                    <a href="{{ url_for('task.update_task', task_id=task.id) }}" class="btn btn-sm btn-warning">编辑</a>
                                    <button type="button" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal{{ task.id }}">删除</button>
                                </td>
                            </tr>
                            
                            <!-- 删除确认模态框 -->
                            <div class="modal fade" id="deleteModal{{ task.id }}" tabindex="-1" aria-hidden="true">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title">确认删除</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            确定要删除任务 "{{ task.title }}" 吗？此操作不可撤销。
                                        </div>
                                        <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
                                            <form action="{{ url_for('task.delete_task', task_id=task.id) }}" method="post">
                                                <button type="submit" class="btn btn-danger">确认删除</button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <div class="alert alert-info">
                暂无任务。点击上方的"创建新任务"按钮开始添加任务。
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}